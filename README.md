# NovelMind AI (小说脑)

**NovelMind AI** 是一款专为**超长篇小说**（百万字级别）设计的深度分析工具。它利用最新的大语言模型（Google Gemini / OpenAI），在浏览器端对小说进行智能分章、剧情摘要、人物性格提取以及关系图谱构建。

> 🚀 **核心理念**：本地优先、隐私安全、长文拆解、全局记忆。

---

## ✨ 核心功能

### 1. 📚 长篇文本处理
- **智能分章**：自动识别小说章节（如“第1章”、“序章”），或根据字数智能切分。
- **超大文件支持**：轻松处理 10MB+ 的 `.txt` 纯文本文件，支持 GBK/UTF-8 编码自动识别。
- **阅读进度记忆**：自动记录并恢复上次阅读的位置。

### 2. 🧠 AI 深度分析
- **剧情摘要**：为每一章生成精炼的剧情概括。
- **上下文连贯**：分析当前章节时，AI 会自动读取上一章的摘要，确保剧情理解的连续性。
- **人物画像**：自动提取章节中的关键角色、性格特征及在剧情中的作用。
- **情感分析**：计算章节的情感正负值。
- **剧情问答**：针对特定章节内容，与 AI 进行由上下文驱动的对话（RAG）。

### 3. 🕸️ 全局知识图谱
- **动态关系**：从每一章的分析中提取“人物关系”（如 A 是 B 的朋友，C 憎恨 D）。
- **可视化图谱**：随着分析进度的推进，实时构建并渲染全局人物关系网。
- **力导向布局**：支持拖拽、缩放，直观查看复杂的人物纠葛。

### 4. 💾 数据管理与安全
- **本地存储 (IndexedDB)**：所有小说原文、分析结果均存储在您的浏览器本地数据库中，不上传至任何中心化服务器。
- **备份与恢复**：支持将整本书及分析记录导出为 JSON 文件，防止浏览器缓存清理导致数据丢失。

---

## 📖 使用指南

### 第一步：上传小说
1. 打开应用，点击屏幕中央的上传区域或直接拖拽 `.txt` 文件。
2. 系统会自动解析文件编码并进行分章处理（通常只需几秒钟）。

### 第二步：配置 AI 设置
1. 点击右上角的 **设置 (⚙️)** 图标。
2. **模型选择**：
   - **Google Gemini (推荐)**：速度快，免费额度高（需连接 Google 账号）。
   - **OpenAI 兼容模式**：支持 GPT-4, DeepSeek 等，需填入 Base URL 和 API Key。
3. **分段大小**：默认为 5万字/段。对于超长篇小说，建议适当调大此数值以减少 API 调用次数。

### 第三步：开始分析
1. 在阅读界面右侧的“AI 助手”面板中，点击 **“开始分析”**。
2. AI 将生成摘要、人物和关系数据。
3. **注意**：您可以按需逐章分析，也可以在阅读时随时触发。

### 第四步：查看图谱与问答
- **切换视图**：在顶部导航栏切换“正文阅读”与“关系图谱”。
- **剧情问答**：在右侧面板切换到“剧情问答”标签，询问诸如“这章主角为什么生气？”等问题。

### ⚠️ 重要：数据备份
由于数据存储在浏览器本地：
1. 请勿随意清除浏览器缓存。
2. **强烈建议**：在关闭浏览器前，或进行重要分析后，点击书架页面的 **“导出 (下载图标)”**，保存备份文件到电脑。
3. 若更换电脑或浏览器，使用 **“导入备份”** 即可恢复所有进度。

---

## 🛠️ 安装与运行 (开发人员)

本项目基于 React + Vite + TypeScript 构建。

### 环境要求
- Node.js (v18 或更高版本)
- npm 或 yarn

### 1. 安装依赖
```bash
npm install
# 或者
yarn install
```

### 2. 配置环境变量 (可选)
虽然应用支持在前端设置 API Key，但您也可以在项目根目录创建 `.env` 文件预设 Key：
```env
# 仅用于开发环境，生产环境建议由用户在 UI 中输入
VITE_API_KEY=your_google_gemini_api_key
```

### 3. 启动开发服务器
```bash
npm run dev
```
浏览器访问 `http://localhost:5173` 即可看到应用。

### 4. 构建生产版本
```bash
npm run build
```

---

## 🧩 技术栈

- **前端框架**: React 19
- **构建工具**: Vite
- **语言**: TypeScript
- **UI 库**: Tailwind CSS, Lucide React
- **图表/可视化**: Recharts, 自定义 SVG 力导向图
- **AI SDK**: @google/genai (官方 SDK)
- **数据库**: IndexedDB (原生)

---

## ❓ 常见问题

**Q: 为什么书架里的书不见了？**
A: 可能是您清除了浏览器缓存（Cookie/Site Data）。请使用您之前导出的 JSON 备份文件重新导入。

**Q: 分析速度很慢？**
A: 这取决于所选模型的响应速度和分段的长度。Gemini Flash 通常最快。

**Q: 支持 PDF 或 ePub 吗？**
A: 目前仅支持 `.txt` 文本文件。请先将电子书转换为 txt 格式。
